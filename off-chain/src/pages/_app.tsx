import { StoreProvider } from 'easy-peasy';
import { Session } from 'next-auth';
import { SessionProvider } from 'next-auth/react';
import type { AppProps } from 'next/app';
import Head from 'next/head';
import { ReactNotifications } from 'react-notifications-component';
import 'react-notifications-component/dist/theme.css';
import { AppGeneral, globalStore, useWalletStore } from 'smart-db';
import Layout from '../components/UI/Layout/Layout';
import { metadata } from './_document';
// import 'smart-db/dist/styles.css';
import 'styles/global.scss';
import { Address, applyParamsToScript, Blockfrost, Data, Lucid, MintingPolicy, PolicyId, SpendingValidator, Unit, UTxO } from 'lucid-cardano';
import { createContext, Dispatch, SetStateAction, useEffect, useState } from 'react';
import WalletSelectorModal, { Wallet } from '@/components/Commons/WalletConnector/WalletSelectorModal';
import WalletConnector from '../components/Commons/WalletConnector/WalletConnector';

export const marketScript: SpendingValidator = {
    type: 'PlutusV2',
    script: '59102f59102c01000032323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232322223232323232323232323232323232323232533553355333573460aa6602e607609a014084266ae7124012445787065637465642065786163746c79206f6e652053656c6c4f6666657220696e70757400028153350011003100c043112001165333573460a80020842a666ae68c14c004104138d55ce9baa0115335533533355303804a30120132350012233355303b04d30150162350012233350012330284800000409c8cc0a000520000013301933355304904a301870008c646a018444444444444666aa60ac0ae446a00444446a0084466a0044a666ae68cdc780b00089982f003004080410040298051a8068281982419821245003304833042488100337006a01a4440326a01a44403408c08c07e266ae712410f53656c6c6572206e6f74207061696400025153355333573460a466028607009400e07e266ae71241124578706563746564206f6e6520696e70757400025153355335333355303804a0152202700604603f1335738921134578706563746564206e6f206f7574707574730002515335533500103f1335738921256e6f74206973436f72726563745f4f75747075745f53696d706c6553616c655f446174756d000251533500203f1335738921256e6f74206973436f72726563745f4f75747075745f53696d706c6553616c655f56616c7565000250400400400405333573466e3cd400813cd403013c54ccd5cd19b8f3500204e3500c04e15333573466e3cd4008134d403013454ccd5cd19b8f350022220363500c22203615333573466e1cd4008888060d40308880604ccd5cd19b87350022220193500c22201904502403f03f03f03f03f3303835002223500220353330167006608c660809110033046330404881003500b2220180440443330167006a0064466090660840046609066084002900102302319823198201a80582619823198201a80591101aa40040880886a00207ca66a6082244666042446a00444446a0084466a00440104a66a6a01844666ae68cdc41982f1119a800a4000446a00444a666ae68cdc78010040998321119a800a4000446a00444a666ae68cdc7801006880089803001800898030018042400405c09e266016660920126a026446a0164444a666a00405642608800242a66a6a00e444444444444660de44a66a0020b84426a00444a666ae68cdc78010098982a8008980300180110982280081600408040008028980da4c442a66a0022004442603e931981e9a8040252450e4d61726b6574506f6c696379494400303f12233301f223253355335302300113301f00100703f13300500300210023500222220040013500722222222222200a303e12233301e223253355335302200113301e00100603e1330053500303f0021002353500203e222200400135006048353500422333350010450450452353330502225335002153357389211e676574556e736166655f5478496e496e666f5f42795f54784f75745265660016221350022253355333573466e3cd4008124d40141244ccd5cd19b8735002043350050430480270421330440020011330070030053500304800103c2222004533535002222222222222533533355303b04d3304522533500221003100102825333573466e3c0380044c0e4004110010810c10c0d84cd5ce2481104f776e6572206e6f74207369676e65640001c350030463500103c53335734608a6aae740084c8c8c8c848cc00400c008c094d5d09aba200353335734608e6aae740044c8c8c8c8c8c8c8c8c8c8c8c8c8c8c8c8c8c8c8c8c8c8c8c848cccccccccccc00406005805004804003803002401c01400c008c100d5d09aba200233303875c40026ae84004d5d100119981b01c10009aba1001357440046606aeb8d5d08009aba20035333573460ae6aae740044c8c8c8c8c848cc0040100094ccd5cd182d9aab9d001132323212330010030023032357426ae88008cc0c9d69aba100135573c0020ac6ea8d5d09aba20035333573460b26aae740044c8c8c848cc00400c008c0c0d5d09aba20023303075a6ae84004d55cf00082a1baa357420026aae78004148dd51aba10013574400466605e066eb4d5d08009aba20023302e030357420026ae88008ccc0add70151aba100135744004666052eb80a0d5d08009aba200233028024357420026ae88008cc098084d5d08009aba20023302401f357420026aae78004108dd51aba100135573c00408060520086ea80048cc0c488ccd400c0e0008004d40040c048cc004894cd400840040c00d088cccd54008cc0c088ccd40140dc004008d400c0bc88cdc0000a400400290001981691118019801000900091100111100091119aa981101a91a800911981800119aa981281c11a8009119819801199a800919805240000020124660140029000000998020010009119aa981001991a8009119817001199a800919aa981201b91a8009119819001180600080091199804008001000919aa981201b91a80091198190011806800800999801805801000911199aa981901981899aa981001991a80091198170011804000999aa9819019911a80111299a999aa981281b998179119980501b001000980401711a8009119805001002803080189981a80200181780099aa981001991a80091198170011982091299a800898058019109a80111299a9980600100408911198010050020980300180200111980091299a80101388008059091118018021091118008020a99ab9c4911a676574556e736166655f446174756d5f46726f6d5f54784f757400162533573892012545787065637465642065786163746c79206f6e652053696d706c6553616c6520696e7075740016223500222350032232335005233500425333573466e3c00800400c0a480388cd4010803894ccd5cd19b8f002001003029153350032153350022133500223350022335002233500223300e00200120112335002201123300e00200122201122233500420112225333573466e1c01800c54ccd5cd19b8700500213300f00400102e02e02715335001202702522333573466e1c00800409c01888ccd5cd19b8f00200102600522303422533500110032213300600230040012350012233500220052026101c23253335734605c0020362a666ae68c0b40040700a0d55ce9baa001223232533357346060002224440022a666ae68c0bc0044c84888c00c010c010d5d09aab9e002153335734605c002224440040526aae74004dd50009192999ab9a302b35573a0022646603a601a6ae84004c010d5d09aba200135573c00204c6ea80048c94ccd5cd18151aab9d0011323232323232323232321233330010090070030023300c75c6ae84d5d10022999ab9a303400113212223002004357426aae7800854ccd5cd1819800899091118008021bae357426aae7800854ccd5cd1819000889110018169aab9d00137546ae84004d5d1001199804bae008357420026ae8800d4ccd5cd18161aab9d001132323212330010030023300700d357426ae88008c034d5d08009aab9e00102737546ae84004d55cf0008129baa0012232325333573460560022601e60086ae84d55cf0010a999ab9a302c00101a02635573a0026ea8004cc005d73ad2223302c2233335573e0024040464660466603a600e6aae74004c018d55cf00098021aba2003357420040466eac00488cc0a888cccd55cf800900f11981018029aba10023003357440040426eb00048c8c94ccd5cd181480089909111180200298021aba135573c0042a666ae68c0a00044c848888c008014c014d5d09aab9e002153335734604e00226424444600200a600e6ae84d55cf0010a999ab9a3026001132122223003005375c6ae84d55cf0010109aab9d00137540024646464a666ae68cdc3a401800422444401a2a666ae68cdc3a40140042240482a666ae68cdc3a40100042646424444444660020120106eb4d5d09aba25002375c6ae85400454ccd5cd18148010991909111111198010048041bae357426ae894008dd71aba15001153335734605000426464244444446600c0120106eb8d5d09aba25002300535742a0022a666ae68c09c0084c848888888c01c020c014d5d09aab9e003153335734604c00426424444444600a010600a6ae84d55cf00181089aab9e00235573a0026ea80048c8c94ccd5cd1812800899191919190911998008030020019bad357426ae88008dd69aba1001357440046eb4d5d08009aab9e0021533357346048002264244600400660086ae84d55cf00100f9aab9d001375400246464a666ae68c0900044c8488c00400cdd71aba135573c0042a666ae68c08c0044c8488c00800cdd71aba135573c00403c6aae74004dd50009192999ab9a302135573a002264646424660020060046eb4d5d09aba20023004357420026aae78004070dd50009192999ab9a302035573a00226eb8d5d09aab9e00101b375400244400642446004006464a666ae68c074d55ce80089919191919191919191919091999998008058048038028018011bad357426ae88008dd69aba1001357440046eb8d5d08009aba2002375c6ae84004d5d10011bae357420026ae88008dd71aba100135573c0020306ea8004c0788844894cd4004030884cc05cc010008cd54c018064010004c07488448894cd40044d400c038884ccd4014058c010008ccd54c01c064014010004d4008020d4004034c0204888cc00c894cd400854cd4004024884d4008894cd4cc02c0500044cc02005000c038884d4008894cd401454cd4cc02c0040504cc02000c050038884d4008894ccd5cd19b8f006002153353300f00500113300c0070030121333300b3301400600500730171223300233016004003001003222235004225335003153353300b00101413300800500400e22135002225333573466e3c01800854cd4cc03c0140044cc030024ccd54c06c07006800c0200484cccc02ccc050018014024cc068cc05000800402000cd4008014d4004028c0144888cc00c894cd400854cd4004018884d4008894ccd5cd180e0008998040088018059109a80111299a8028a999ab9a301c00113300800301100b22135002223253335734604200c26601a01066030660240060040082a666ae68c0840084cc034cc060cc04801c01802001054ccd5cd19b8f00700315333573466e1c0180084cc0340200100040044cccc02ccc04401801401cc050488cc008cc04c01000c00400c8888d4010894cd400c02c884d4008894ccd5cd181000089999805998088030028048040018a999ab9a3371e00c0042a666ae68cdc3802800899806004999aa980c00c80b80180409999805998088030028049980b9980880100080400189999805998088030028049980b99808801000804001880388800910009109198008018011198010010009119190919800918019118010019180191180080191a98010019a8018009801001119a800802001080091001110911980080200198061108911299a800880111099802801199aa9803804002802000890009299ab9c49119676574556e736166655f4f776e5f496e7075745f54784f7574001615335738920103505431001622222222222200c222222004222222005222222006370e90001b8748008dc3a40086e1d200623230010012233003300200200101',
};
export const mintingPolicyIDScript = '590fbb590fb801000032323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232322322232323232323232533533553335734609a0022642446004006a666ae68c12cd55ce9baa357426aae7800807c11854ccd5cd18260008990911800801a999ab9a304b35573a6ea8d5d09aab9e00201f0460462533533036301700735005223304633040002330463304000133702900024004088088076266ae71241156e6f742069734275726e696e674d61726b657449440001f2323232323232533553353303c301d00d00a0411335738921156e6f742069734d696e74696e674d61726b65744944000251533553350030411335738921216e6f74206973436f72726563745f4f75747075745f4d61726b65745f446174756d000251533553350020411335738921216e6f74206973436f72726563745f4f75747075745f4d61726b65745f56616c75650002515335333355303a04c01e2202700104804113357389211b6578706563746564207a65726f204d61726b657420696e7075747300025042042042304612233301c223253355335302000113301e001015046133005350030470021002353500204622220040013500d22222222222200c3303a35004203533301d70066090660849110033048330424881003500322201504604633301d7006a0124466094660880046609466088002900102402419824198211a80182699824198211a80191101ba400408c08ca666ae68cdc79a8010271a8008270a999ab9a3371e6a00409a6a00209a2a666ae68cdc79a8010261a8008260a999ab9a3371e6a00444406c6a00244406c2a666ae68cdc39a8011110099a8009110098999ab9a3370e6a0044440286a00244402808a04407e07e07e07e07e6666660286a00209a6a0020986a0020966a00244406a6a0024440246a002444026a66a6a0024444a666a0042a66ae71240129466f756e6420436f6c6c61746572616c206f757470757420627574204e6f4f7574707574446174756d00162130150012153353500c2222222222223306222533500105022135002225333573466e3c00804c4c1240044c01800c00884c0580041088400454cd5ce2490f446174756d206e6f7420666f756e64001653353041122333017223253355335301b00113301900101004113300500300210023500222220040013500822222222222200a130134988854cd40044008884c05d2601f1635573a0026ea801cd400488cc108cc0f0008cc108cc0f0005200204004033039301c0024890e4d61726b6574506f6c6963794944003500103d53335734608a6aae740044c8c8c8c848cc00400c008c098d5d09aba200353335734608e6aae740044c8c8c8c8c8c8c8c8c8c8c8c8c8c8c8c8c8c8c8c8c8c8c8c848cccccccccccc00406005805004804003803002401c01400c008c104d5d09aba200233303975c40026ae84004d5d100119981b81c90009aba1001357440046606ceb8d5d08009aba20035333573460ae6aae740044c8c8c8c8c848cc0040100094ccd5cd182d9aab9d001132323212330010030023033357426ae88008cc0cdd69aba100135573c0020ac6ea8d5d09aba20035333573460b26aae740044c8c8c848cc00400c008c0c4d5d09aba20023303175a6ae84004d55cf00082a1baa357420026aae78004148dd51aba100135744004666060068eb4d5d08009aba20023302f031357420026ae88008ccc0b1d70159aba100135744004666054eb80a4d5d08009aba200233029025357420026ae88008cc09c088d5d08009aba200233025020357420026aae78004108dd51aba100135573c0020806ea8004cc0ccc09cdd700080a11100111100091999999aba40012325333573460806aae740044c8cccd55cf800900a9191999aab9f001201723233335573e00240324646666aae7c004806c8c8cccd55cf800900e9191999aab9f001201f233335573e6ae8800894cd4c048d5d080690a99a98099aba100c21533530143574201642a66a602a6ae84028854cd4c054d5d080490a99a980b1aba100821303833333301900600500400300200104204104003f03e03d2020046045357440040866ae88008104d5d100101f9aba200203d357440040766aae780040c0dd5001100910091009100901c11999999aba400120112011201123023375a004402206e46666666ae9000480408040804080408c088dd700101b111111091999998008038030028020018011299ab9c49011a65787065637465642065786163746c79206f6e6520696e7075740016223500222350032232335005233500425333573466e3c00800400c0c480508cd4010805094ccd5cd19b8f002001003031153350032153350022133500223350022335002233500223301600200120172335002201723301600200122201722233500420172225333573466e1c01800c54ccd5cd19b870050021333573466e1c0100040f00640d80d80bc54cd400480bc0b488c0f4894cd4004400c884cc018008c0100048d400488cd4008803480c08d400488d4008888888888888c8c8cc128894cd40044c00c06c884d4008894ccd5cd19b8f0020081300730310011300600300a2333355302e0403303822333501403f001002350120372233301570000200466aa605a08046a00244660826607600a660826607600400207e07ea66a002420022a66ae7124010866726f6d4a75737400163303e330384881003303e33038488100480000f00f0c06403ccc098888c00cc0080048004888cd54c0740c08d400488cc0ac008cd54c0800cc8d400488cc0b8008ccd40048cc029200000100923300a00148000004cd54c0740c08d400488cc0ac008ccd40048cd54c0840d08d400488cc0bc008c03400400488ccc0240340080048cd54c0840d08d400488cc0bc008c038004004ccc010020008004888ccd54c0b80bc0b4cd54c0700bc8d400488cc0a8008c020004ccd54c0b80bc88d4008894cd4ccd54c0840cccc0ac88ccc0280c8008004c0200a88d400488cc028008014018400c4cc0c401000c0ac004cd54c0700bc8d400488cc0a8008cc0f0894cd40044c02c00c884d4008894cd4cc03000802044888cc0080280104c01800c0100088cc004894cd400808c400401484888c00c01084888c00401088ccd5cd19b8f002001026003101e1026235001223333500102a200102a02a23253335734605a0020362a666ae68c0b000407009cd55ce9baa00122323253335734605e002224440022a666ae68c0b80044c84888c00c010c010d5d09aab9e002153335734605a002224440040506aae74004dd50009192999ab9a302a35573a00226464642466002006004600a6ae84d5d100118069aba100135573c00204a6ea80048c94ccd5cd18149aab9d0011323232323232323232321233330010090070030023300c75c6ae84d5d10022999ab9a303300113212223002004357426aae7800854ccd5cd1819000899091118008021bae357426aae7800854ccd5cd1818800889110018161aab9d00137546ae84004d5d1001199804bae008357420026ae8800d4ccd5cd18159aab9d0011323301e300d357420026600c0186ae84d5d10009aab9e00102637546ae84004d55cf0008121baa0012232325333573460540022601e60086ae84d55cf0010a999ab9a302b00101a02535573a0026ea8004cc005d73ad2223302b2233335573e0024040464660466603a600e6aae74004c018d55cf00098021aba2003357420040466eac00488cc0a488cccd55cf800900f11981018029aba10023003357440040426eb00048c8c94ccd5cd181400089909111180200298021aba135573c0042a666ae68c09c0044c848888c008014c014d5d09aab9e002153335734604c00226424444600200a600e6ae84d55cf0010a999ab9a3025001132122223003005375c6ae84d55cf0010101aab9d00137540024646464a666ae68cdc3a401800422444401a2a666ae68cdc3a40140042240462a666ae68cdc3a40100042646424444444660020120106eb4d5d09aba25002375c6ae85400454ccd5cd18140010991909111111198010048041bae357426ae894008dd71aba15001153335734604e00426464244444446600c0120106eb8d5d09aba25002300535742a0022a666ae68c0980084c848888888c01c020c014d5d09aab9e003153335734604a00426424444444600a010600a6ae84d55cf00181009aab9e00235573a0026ea80048c8c94ccd5cd1812000899191919190911998008030020019bad357426ae88008dd69aba1001357440046eb4d5d08009aab9e0021533357346046002264244600400660086ae84d55cf00100f1aab9d001375400246464a666ae68c08c0044c020dd71aba135573c0042a666ae68c0880044c8488c00800cdd71aba135573c00403a6aae74004dd50009192999ab9a302035573a002264646424660020060046eb4d5d09aba20023004357420026aae7800406cdd50009192999ab9a301f35573a00226eb8d5d09aab9e00101a37540024440064244600400642446002006603a442244a66a0020184426602e600800466aa600c03200800260384422444a66a00226a00601c442666a00a02c6008004666aa600e03200a0080026a0040106a00201a601024446600644a66a0042a66a0020124426a00444a66a6601602800226601002800601c4426a00444a66a00a2a66a6601600202826601000602801c4426a00444a666ae68cdc78030010a99a99807802800899806003801809099998059980a003002803980b891198011980b00200180080191111a80211299a8018a99a9980580080a0998040028020071109a801112999ab9a3371e00c0042a66a6601e00a002266018012666aa6036038034006010024266660166602800c00a01266034660280040020100066a00400a6a002014600a24446600644a66a0042a66a00200c4426a00444a666ae68c06c0044cc02004400c02c884d4008894cd401454ccd5cd180d8008998040018088059109a80111192999ab9a302000613300d0083301833012003002004153335734604000426601a660306602400e00c0100082a666ae68cdc78038018a999ab9a3370e00c00426601a010008002002266660166602200c00a00e6028244660046602600800600200644446a00844a66a0060164426a00444a666ae68c07c0044cccc02ccc04401801402402000c54ccd5cd19b8f00600215333573466e1c0140044cc030024ccd54c06006405c00c0204cccc02ccc044018014024cc05ccc04400800402000c4cccc02ccc044018014024cc05ccc04400800402000c401c44004880048848cc00400c0088cc00800800488c8c848cc0048c00c88c00800c8c00c88c00400c8d4c00800cd400c004c0080088cd400401000840048800888488cc00401000cc02c88448894cd40044008884cc014008ccd54c01c0200140100044800454cd5ce2481035054310016253357389201024c680016222222004222222005222222006370e90001b8748008dc3a40086e1d20062323001001223300330020020011'

// export const mintingPolicyID: MintingPolicy = {
//     type: 'PlutusV2',
//     script: mintingPolicyIDScript
// };
//
export type MenuClass = 'Buy' | 'Sell';

export type AppState = {
    // Global
    lucid?: Lucid;
    wAddr?: Address;
    marketAddress?: Address;
    menuClass?: string;
};

const initialAppState: AppState = {
    lucid: undefined,
    wAddr: undefined,
    marketAddress: 'undefined',
    menuClass: 'Buy',
};

export const AppStateContext = createContext<{
    appState: AppState;
    setAppState: Dispatch<SetStateAction<AppState>>;
}>({ appState: initialAppState, setAppState: () => {} });

export default function MyApp({ Component, pageProps }: AppProps<{ session?: Session }>) {
    const [appState, setAppState] = useState<AppState>(initialAppState);
    const [showWalletModal, setShowWalletModal] = useState(false);

    useEffect(() => {
        if (appState.lucid) return;
        setShowWalletModal(true);
    }, [appState]);

    return (
        <AppStateContext.Provider value={{ appState, setAppState }}>
            <SessionProvider session={pageProps.session} refetchInterval={0}>
                <StoreProvider store={globalStore}>
                    <AppGeneral />
                    <ReactNotifications />
                    <Layout>
                        <Component {...pageProps} />
                    </Layout>
                </StoreProvider>
            </SessionProvider>
        </AppStateContext.Provider>
    );
}

// export default function MyApp({ Component, pageProps }: AppProps<{ session?: Session }>) {
//     return (
//         <>
//             <SessionProvider session={pageProps.session} refetchInterval={0}>
//                 <StoreProvider store={globalStore}>
//                     <AppGeneral />
//                     <ReactNotifications />
//                     <Layout>
//                         <Component {...pageProps} />
//                     </Layout>
//                 </StoreProvider>
//             </SessionProvider>
//         </>
//     );
// }
