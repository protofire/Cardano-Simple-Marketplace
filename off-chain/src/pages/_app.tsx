import { StoreProvider } from 'easy-peasy';
import { Session } from 'next-auth';
import { SessionProvider } from 'next-auth/react';
import type { AppProps } from 'next/app';
import Head from 'next/head';
import { ReactNotifications } from 'react-notifications-component';
import 'react-notifications-component/dist/theme.css';
import { AppGeneral, globalStore, useWalletStore } from 'smart-db';
import Layout from '../components/UI/Layout/Layout';
import { metadata } from './_document';
// import 'smart-db/dist/styles.css';
import 'styles/global.scss';
import { Address, applyParamsToScript, Blockfrost, Data, Lucid, MintingPolicy, PolicyId, SpendingValidator, Unit, UTxO } from 'lucid-cardano';
import { createContext, Dispatch, SetStateAction, useEffect, useState } from 'react';
import WalletSelectorModal, { Wallet } from '@/components/Commons/WalletConnector/WalletSelectorModal';
import WalletConnector from '../components/Commons/WalletConnector/WalletConnector';

export const marketScript: SpendingValidator = {
    type: 'PlutusV2',
    script: '590fe9590fe601000032323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232322223232323232323232323232323232323232533553355333573460a46602e607609a012084266ae7124012445787065637465642065786163746c79206f6e652053656c6c4f6666657220696e70757400027153350011003100b043112001165333573460a20020842a666ae68c140004104138d55ce9baa0115335533533355303804a30120132350012233355303b04d3015016235001223335001233027480000040988cc09c00520000013301833355304904a301770008c646a016444444444444666aa60ac0ae446a00444446a0084466a0044a666ae68cdc780b00089982f003004080410040298051a806911100219824198212450033048330424881003500d222200104604603f133573892010f53656c6c6572206e6f742070616964000241533553335734609e66028607009400c07e266ae71241124578706563746564206f6e6520696e70757400024153355335333355303804a0152202600504603f1335738921134578706563746564206e6f206f7574707574730002415335533500103f1335738921256e6f74206973436f72726563745f4f75747075745f53696d706c6553616c655f446174756d000241533500203f1335738921256e6f74206973436f72726563745f4f75747075745f53696d706c6553616c655f56616c7565000240400400400405333573466e3cd40088888010d403088880104d40088888d404088894cd4cc07401c00c54cd4cc0740180084ccd5cd19b8700500104d02b04704703f3303835002223500220353330157006a014446609066084004660906608400290010230231a9a80091110011119824198210011982419821000a400408c08c6a00207ca66a6082244666040446a00444446a0084466a00440104a66a6a02644666ae68cdc41982d9119a800a4000446a00444a666ae68cdc78010040998309119a800a4000446a00444a666ae68cdc7801006880089803001800898030018042400405a09e266016660920126a024446a0164444a666a00405442608600242a66a6a00e444444444444660d844a66a0020b84426a00444a666ae68cdc7801009898298008980300180110982200081580408040008020980d24c442a66a0022004442603c93182009119980f9119299aa99a981180089980f80080382009980280180108011a80111110020009a803911111111111005181f89119980f1119299aa99a981100089980f00080301f8998029a80182000108011a9a80101f91110020009a8030249a9a802111999a80082302302311a999827111299a8010a99ab9c4911e676574556e736166655f5478496e496e666f5f42795f54784f75745265660016221350022253355333573466e3cd4008128d40141284ccd5cd19b8735002044350050440490270431330450020011330070030053500304900103d2222004533535002222222222222533533355303c04e3304622533500221003100102825333573466e3c0380044c0e000411401081101100dc4cd5ce2481104f776e6572206e6f74207369676e65640001c3500422220043500103d5333573460866aae7400c4c8c8c8c848cc00400c008c094d5d09aba200353335734608a6aae740044c8c8c8c8c8c8c8c8c8c8c8c8c8c8c8c8c8c8c8c8c8c8c8c848cccccccccccc00406005805004804003803002401c01400c008c100d5d09aba200233303875c40026ae84004d5d100119981b01c10009aba1001357440046606aeb8d5d08009aba20035333573460aa6aae740044c8c8c8c8c848cc0040100094ccd5cd182c9aab9d001132323212330010030023032357426ae88008cc0c9d69aba100135573c0020ae6ea8d5d09aba20035333573460ae6aae740044c8c8c848cc00400c008c0c0d5d09aba20023303075a6ae84004d55cf00082a9baa357420026aae7800414cdd51aba10013574400466605e066eb4d5d08009aba20023302e030357420026ae88008ccc0add70151aba100135744004666052eb80a0d5d08009aba200233028024357420026ae88008cc098084d5d08009aba20023302401f357420026aae7800410cdd51aba100135573c0060826a002405260500086ea80048cc0c488ccd400c0e0008004d40040c048cc004894cd400840040c00d088cccd54008cc0c088ccd40140dc004008d400c0bc88cdc0000a4004002900019816911180198010009000911a801111a801912999ab9a3371e00800426602200600206044466aa604606c46a002446606200466aa604c07246a0024466068004666a0024660149000000804919805000a4000002660080040024466aa604206846a002446605e004666a002466aa604a07046a0024466066004601800200244666010020004002466aa604a07046a0024466066004601a002002666006016004002444666aa606606806466aa604206846a002446605e0046010002666aa6066068446a00444a66a666aa604c070660604466601406e004002601005e46a002446601400400a00c200626606c00800606000266aa604206846a002446605e0046607e44a66a002260160064426a00444a66a6601800401022444660040140082600c00600800446600244a66a00405020020164244460060084244460020082a66ae7124011a676574556e736166655f446174756d5f46726f6d5f54784f757400162533573892012545787065637465642065786163746c79206f6e652053696d706c6553616c6520696e7075740016223500222350032232335005233500425333573466e3c00800400c0a880388cd4010803894ccd5cd19b8f00200100302a153350032153350022133500223350022335002233500223300e00200120112335002201123300e00200122201122233500420112225333573466e1c01800c54ccd5cd19b8700500213300f00400102f02f02815335001202802622333573466e1c0080040a001888ccd5cd19b8f00200102700522303222533500110032213300600230040012350012233500220052027101d2325333573460580020382a666ae68c0ac0040740a4d55ce9baa00122323253335734605c002224440022a666ae68c0b40044c84888c00c010c010d5d09aab9e0021533357346058002224440040546aae74004dd50009192999ab9a302935573a0022646603c601a6ae84004c010d5d09aba200135573c00204e6ea80048c94ccd5cd18141aab9d0011323232323232323232321233330010090070030023300c75c6ae84d5d10022999ab9a303200113212223002004357426aae7800854ccd5cd1818800899091118008021bae357426aae7800854ccd5cd1818000889110018171aab9d00137546ae84004d5d1001199804bae008357420026ae8800d4ccd5cd18151aab9d001132323212330010030023300700d357426ae88008c034d5d08009aab9e00102837546ae84004d55cf0008131baa0012232325333573460520022601c60086ae84d55cf0010a999ab9a302a00101b02735573a0026ea8004cc005d73ad2223302a2233335573e0024042464660486603c600e6aae74004c018d55cf00098021aba2003357420040486eac00488cc0a088cccd55cf800900f91981098029aba10023003357440040446eb00048c8c94ccd5cd181380089909111180200298021aba135573c0042a666ae68c0980044c848888c008014c014d5d09aab9e002153335734604a00226424444600200a600e6ae84d55cf0010a999ab9a3024001132122223003005375c6ae84d55cf0010111aab9d00137540024646464a666ae68cdc3a401800422444401c2a666ae68cdc3a40140042244444440082a666ae68cdc3a40100042646424444444660020120106eb4d5d09aba25002375c6ae85400454ccd5cd18138010991909111111198010048041bae357426ae894008dd71aba15001153335734604c00426464244444446600c0120106eb8d5d09aba25002300535742a0022a666ae68c0940084c848888888c01c020c014d5d09aab9e003153335734604800426424444444600a010600a6ae84d55cf00181109aab9e00235573a0026ea80048c8c94ccd5cd1811800899191919190911998008030020019bad357426ae88008dd69aba1001357440046eb4d5d08009aab9e0021533357346044002264244600400660086ae84d55cf0010101aab9d001375400246464a666ae68c0880044c8488c00400cdd71aba135573c0042a666ae68c0840044c8488c00800cdd71aba135573c00403e6aae74004dd50009192999ab9a301f35573a002264646424660020060046eb4d5d09aba20023004357420026aae78004074dd50009192999ab9a301e35573a00226eb8d5d09aab9e00101c375400242446004006444006464a666ae68c06cd55ce8008991919191919190919998008038028018011bad357426ae88008ccc021d73ae357420026ae88008ccc019d73ae357420026ae88008dd71aba100135573c0020326ea8004888c94ccd5cd180e1aab9d0011323301130053574200260086ae84d5d10009aab9e00101a37540026036442244a66a0020184426602e600800466aa600c03200800260344422444a66a00226a00601c442666a00a02c6008004666aa600e03200a0080026a0040106a00201a601024446600644a66a0042a66a0020124426a00444a66a6601602800226601002800601c4426a00444a66a00a2a66a6601600202826601000602801c4426a00444a666ae68cdc78030010a99a99807802800899806003801809099998059980a003002803980b891198011980b00200180080191111a80211299a8018a99a9980580080a0998040028020071109a801112999ab9a3371e00c0042a66a6601e00a002266018012666aa6036038034006010024266660166602800c00a01266034660280040020100066a00400a6a002014600a24446600644a66a0042a66a00200c4426a00444a666ae68c0640044cc02004400c02c884d4008894cd401454ccd5cd180c8008998040018088059109a80111192999ab9a301e00613300d0083301833012003002004153335734603c00426601a660306602400e00c0100082a666ae68cdc78038018a999ab9a3370e00c00426601a010008002002266660166602200c00a00e6028244660046602600800600200644446a00844a66a0060164426a00444a666ae68c0740044cccc02ccc04401801402402000c54ccd5cd19b8f00600215333573466e1c0140044cc030024ccd54c06006405c00c0204cccc02ccc044018014024cc05ccc04400800402000c4cccc02ccc044018014024cc05ccc04400800402000c401c44004880048848cc00400c0088cc00800800488c8c848cc0048c00c88c00800c8c00c88c00400c8d4c00800cd400c004c0080088cd400401000840048800888488cc00401000cc02488448894cd40044008884cc014008ccd54c01c0200140100044800494cd5ce248119676574556e736166655f4f776e5f496e7075745f54784f7574001615335738920103505431001622222222222200c370e90001b8748008dc3a40086e1d20062323001001223300330020020011',
};
export const mintingPolicyIDScript = '590f7a590f7701000032323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232232223232323232323253353355333573460920022642446004006a666ae68c11cd55ce9baa357426aae7800807811454ccd5cd18240008990911800801a999ab9a304735573a6ea8d5d09aab9e00201e0450452320423500522330453303f002330453303f001337029000240040860864646464646464a66aa66a660766a01a446a0044444444444446464660c444a66a0022600606c4426a00444a666ae68cdc78010040980398260008980300180511999aa982482d9982991199a81282d0008011a811829111998133800010023355304805b235001223305c330560053305c3305600200105a05a533500121001153357389210866726f6d4a7573740016330593305348810033059330534881004800015c15cc0d006c0281004cd5ce2481156e6f742069734d696e74696e674d61726b65744944000241533553350030401335738921216e6f74206973436f72726563745f4f75747075745f4d61726b65745f446174756d000241533553350020401335738921216e6f74206973436f72726563745f4f75747075745f4d61726b65745f56616c75650002415335333355303904b0132202600104704013357389211b6578706563746564207a65726f204d61726b657420696e707574730002404104104130451223330232232533553353027001133024001015045133005350030460021002353500204522220040013500d22222222222200c330393500420343330127006a012446609266086004660926608600290010238239a9a801900c9119824998218011982499821800a400408e08ea666ae68cdc79a80111110021a800911100209a80111111a8029111299a9980f0038018a99a9980f0030010999ab9a3370e00a00209805208c08c07c66660346a00244440086a00240646a002402e6a0024444002a66a6a0024444a666a0042a66ae71240129466f756e6420436f6c6c61746572616c206f757470757420627574204e6f4f7574707574446174756d001621301b0012153353500c2222222222223305e22533500104f22135002225333573466e3c00804c4c1200044c01800c00884c0700041048400454cd5ce2490f446174756d206e6f7420666f756e6400165335304012233301e223253355335302200113301f00101004013300500300210023500222220040013500822222222222200a130194988854cd40044008884c0752601e1635573a0026ea801cd400488cc104cc0ec008cc104cc0ec005200203f03f33038301b0024890e4d61726b6574506f6c6963794944003500103c5333573460826aae740044c8c8c8c848cc00400c008c094d5d09aba20035333573460866aae740044c8c8c8c8c8c8c8c8c8c8c8c8c8c8c8c8c8c8c8c8c8c8c8c848cccccccccccc00406005805004804003803002401c01400c008c100d5d09aba200233303875c40026ae84004d5d100119981b01c10009aba1001357440046606aeb8d5d08009aba20035333573460a66aae740044c8c8c8c8c848cc0040100094ccd5cd182b9aab9d001132323212330010030023032357426ae88008cc0c9d69aba100135573c0020aa6ea8d5d09aba20035333573460aa6aae740044c8c8c848cc00400c008c0c0d5d09aba20023303075a6ae84004d55cf0008299baa357420026aae78004144dd51aba10013574400466605e066eb4d5d08009aba20023302e030357420026ae88008ccc0add70151aba100135744004666052eb80a0d5d08009aba200233028024357420026ae88008cc098084d5d08009aba20023302401f357420026aae78004104dd51aba100135573c00207e6ea8004cc0c8c098dd70008099981811118019801000900091119aa981381d11a800911981a80119aa981501e91a800911981c001199a80091980524000002012466014002900000099aa981381d11a800911981a801199a800919aa981581f11a800911981c80118068008009119980480a801000919aa981581f11a800911981c8011807000800999802008001000911199aa981c01c81b99aa981301c91a800911981a0011804000999aa981c01c911a80111299a999aa981581e9981a9119980501e001000980401a11a8009119805001002803080189981d80200181a80099aa981301c91a800911981a0011982191299a800898058019109a80111299a9980600100408911198010050020980300180200111980091299a8010168800807909111801802109111800802111a801111a801912999ab9a3371e00800426601c00600205c44400446666666ae900048c94ccd5cd181b1aab9d00113233335573e002401c4646666aae7c00480408c8cccd55cf80090091191999aab9f0012014233335573e6ae8800894cd4c038d5d080490a99a9998070078079aba100821533533300f0100103574200e4264a66a6666666ae900048068806880688c0b0dd6801100d020109816199980a00280200180081b1aba1006034033032201503b03a357440040706ae880080d8d5d100101a1aab9e001029375400440164016401640160624446666666ae900048c94ccd5cd181b9aab9d00113233335573e002401e4646666aae7c00480448cccd55cf9aba200225335300a3574200a42a66a60146ae8401084c098cc0cc0080040c00bc80480e00dcd5d100101a9aab9e00102a3754004401840184018401806446666666ae9000480248024802480248c06cdd700101791110919998008028020018011299ab9c49011a65787065637465642065786163746c79206f6e6520696e7075740016223500222350032232335005233500425333573466e3c00800400c0a880348cd4010803494ccd5cd19b8f00200100302a153350032153350022133500223350022335002233500223300d00200120102335002201023300d00200122201022233500420102225333573466e1c01800c54ccd5cd19b870050021333573466e1c0100040d40480bc0bc0a054cd400480a009888ccd5cd19b8f00200102800522303222533500110032213300600230040012350012233500220052028101e1026235001223333500102a200102a02a2325333573460540020362a666ae68c0a400407009cd55ce9baa001223232533357346058002224440022a666ae68c0ac0044c84888c00c010c010d5d09aab9e0021533357346054002224440040506aae74004dd50009192999ab9a302735573a00226464642466002006004600a6ae84d5d100118069aba100135573c00204a6ea80048c94ccd5cd18131aab9d0011323232323232323232321233330010090070030023300c75c6ae84d5d10022999ab9a303000113212223002004357426aae7800854ccd5cd1817800899091118008021bae357426aae7800854ccd5cd1817000889110018161aab9d00137546ae84004d5d1001199804bae008357420026ae8800d4ccd5cd18141aab9d0011323301e300d357420026600c0186ae84d5d10009aab9e00102637546ae84004d55cf0008121baa00122323253335734604e0022601e60086ae84d55cf0010a999ab9a302800101a02535573a0026ea8004cc005d73ad222330282233335573e0024040464660466603a600e6aae74004c018d55cf00098021aba2003357420040466eac00488cc09888cccd55cf800900f11981018029aba10023003357440040426eb00048c8c94ccd5cd181280089909111180200298021aba135573c0042a666ae68c0900044c848888c008014c014d5d09aab9e002153335734604600226424444600200a600e6ae84d55cf0010a999ab9a3022001132122223003005375c6ae84d55cf0010101aab9d00137540024646464a666ae68cdc3a401800422444401a2a666ae68cdc3a40140042244444440082a666ae68cdc3a40100042646424444444660020120106eb4d5d09aba25002375c6ae85400454ccd5cd18128010991909111111198010048041bae357426ae894008dd71aba15001153335734604800426464244444446600c0120106eb8d5d09aba25002300535742a0022a666ae68c08c0084c848888888c01c020c014d5d09aab9e003153335734604400426424444444600a010600a6ae84d55cf00181009aab9e00235573a0026ea80048c8c94ccd5cd1810800899191919190911998008030020019bad357426ae88008dd69aba1001357440046eb4d5d08009aab9e0021533357346040002264244600400660086ae84d55cf00100f1aab9d001375400246464a666ae68c0800044c020dd71aba135573c0042a666ae68c07c0044c8488c00800cdd71aba135573c00403a6aae74004dd50009192999ab9a301d35573a002264646424660020060046eb4d5d09aba20023004357420026aae7800406cdd50009192999ab9a301c35573a00226eb8d5d09aab9e00101a375400244400642446004006424460020066034442244a66a0020184426602e600800466aa600c03200800260324422444a66a00226a00601c442666a00a02c6008004666aa600e03200a0080026a0040106a00201a601024446600644a66a0042a66a0020124426a00444a66a6601602800226601002800601c4426a00444a66a00a2a66a6601600202826601000602801c4426a00444a666ae68cdc78030010a99a99807802800899806003801809099998059980a003002803980b891198011980b00200180080191111a80211299a8018a99a9980580080a0998040028020071109a801112999ab9a3371e00c0042a66a6601e00a002266018012666aa6036038034006010024266660166602800c00a01266034660280040020100066a00400a6a002014600a24446600644a66a0042a66a00200c4426a00444a666ae68c0600044cc02004400c02c884d4008894cd401454ccd5cd180c0008998040018088059109a80111192999ab9a301d00613300d0083301833012003002004153335734603a00426601a660306602400e00c0100082a666ae68cdc78038018a999ab9a3370e00c00426601a010008002002266660166602200c00a00e6028244660046602600800600200644446a00844a66a0060164426a00444a666ae68c0700044cccc02ccc04401801402402000c54ccd5cd19b8f00600215333573466e1c0140044cc030024ccd54c06006405c00c0204cccc02ccc044018014024cc05ccc04400800402000c4cccc02ccc044018014024cc05ccc04400800402000c401c44004880048848cc00400c0088cc00800800488c8c848cc0048c00c88c00800c8c00c88c00400c8d4c00800cd400c004c0080088cd400401000840048800888488cc00401000cc02088448894cd40044008884cc014008ccd54c01c0200140100044800454cd5ce249035054310016253357389201024c680016370e90001b8748008dc3a40086e1d200623230010012233003300200200101'

// export const mintingPolicyID: MintingPolicy = {
//     type: 'PlutusV2',
//     script: mintingPolicyIDScript
// };
//
export type MenuClass = 'Buy' | 'Sell';

export type AppState = {
    // Global
    lucid?: Lucid;
    wAddr?: Address;
    marketAddress?: Address;
    menuClass?: string;
};

const initialAppState: AppState = {
    lucid: undefined,
    wAddr: undefined,
    marketAddress: 'undefined',
    menuClass: 'Buy',
};

export const AppStateContext = createContext<{
    appState: AppState;
    setAppState: Dispatch<SetStateAction<AppState>>;
}>({ appState: initialAppState, setAppState: () => {} });

export default function MyApp({ Component, pageProps }: AppProps<{ session?: Session }>) {
    const [appState, setAppState] = useState<AppState>(initialAppState);
    const [showWalletModal, setShowWalletModal] = useState(false);

    useEffect(() => {
        if (appState.lucid) return;
        setShowWalletModal(true);
    }, [appState]);

    return (
        <AppStateContext.Provider value={{ appState, setAppState }}>
            <SessionProvider session={pageProps.session} refetchInterval={0}>
                <StoreProvider store={globalStore}>
                    <AppGeneral />
                    <ReactNotifications />
                    <Layout>
                        <Component {...pageProps} />
                    </Layout>
                </StoreProvider>
            </SessionProvider>
        </AppStateContext.Provider>
    );
}

// export default function MyApp({ Component, pageProps }: AppProps<{ session?: Session }>) {
//     return (
//         <>
//             <SessionProvider session={pageProps.session} refetchInterval={0}>
//                 <StoreProvider store={globalStore}>
//                     <AppGeneral />
//                     <ReactNotifications />
//                     <Layout>
//                         <Component {...pageProps} />
//                     </Layout>
//                 </StoreProvider>
//             </SessionProvider>
//         </>
//     );
// }
